{% load static %}
<!DOCTYPE html>
<html lang="es" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Encargado - UABJB</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="{% static 'encargados/css/styles.css' %}">
</head>
<body class="dashboard-encargado">
    <div class="header">
        <div class="header-content">
            <div style="display: flex; align-items: center; gap: 1rem;">
                <div class="logo"><i class="fas fa-graduation-cap"></i></div>
                <div>
                    <div class="header-title"><i class="fas fa-user-shield"></i> Dashboard Encargado</div>
                    <div class="header-subtitle">Sistema de Gestión UABJB</div>
                </div>
            </div>
            <div class="header-controls">
                <!-- Nuevo: Enlace al perfil -->
                <div class="profile-link">
                    <a href="{% url 'encargados:perfil_encargado' %}" title="Ver mi perfil">
                        <i class="fas fa-user-circle"></i>
                        <span>Mi Perfil</span>
                    </a>
                </div>
                <div class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-moon" id="theme-icon"></i>
                    <span id="theme-text">Modo Oscuro</span>
                </div>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="dashboard-container">
            <h1 class="dashboard-title"><i class="fas fa-calendar-alt"></i> Bienvenido, {{ request.user.first_name|default:request.user.username }}</h1>
            <p class="welcome-text">Gestiona el calendario y las solicitudes del mes actual.</p>

            <div class="navegacion-mes">
                <button class="btn-nav" onclick="cambiarMes(-1)"><i class="fas fa-chevron-left"></i> Anterior</button>
                <span class="titulo-mes" id="titulo-mes">Julio 2025</span>
                <button class="btn-nav" onclick="cambiarMes(1)">Siguiente <i class="fas fa-chevron-right"></i></button>
            </div>
            <div class="calendario-minimalista">
                <table>
                    <thead>
                        <tr class="dias-semana">
                            <th>Dom</th>
                            <th>Lun</th>
                            <th>Mar</th>
                            <th>Mié</th>
                            <th>Jue</th>
                            <th>Vie</th>
                            <th>Sáb</th>
                        </tr>
                    </thead>
                    <tbody id="calendario-body">
                        <!-- El calendario se genera dinámicamente -->
                    </tbody>
                </table>
            </div>
            <div class="dashboard-actions">
                <button class="btn-crear-evento" onclick="mostrarModalCrearEvento()">
                    <i class="fas fa-plus"></i> Crear Evento
                </button>
                <a href="{% url 'reportes:generar_reportes' %}" class="btn-action"><i class="fas fa-file-alt"></i> Generar Reportes</a>
                <a href="{% url 'encargados:lista_solicitudes' %}" class="btn-action"><i class="fas fa-list"></i> Ver Solicitudes</a>
                <a href="{% url 'encargados:solicitudes_aceptadas' %}" class="btn-action"><i class="fas fa-list"></i> Solicitudes Aceptadas</a>
                <a href="{% url 'encargados:solicitudes_pendientes' %}" class="btn-action"><i class="fas fa-list"></i> Solicitudes Pendientes</a>
                <a href="{% url 'logout' %}" class="btn-action"><i class="fas fa-sign-out-alt"></i> Cerrar Sesión</a>
            </div>
        </div>
    </div>

    <!-- Modal para crear evento -->
    <div id="modalCrearEvento" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-plus-circle"></i> Crear Nuevo Evento</h2>
                <button class="close-btn" onclick="cerrarModalCrearEvento()">&times;</button>
            </div>
            <form id="formCrearEvento">
                {% csrf_token %}
                <div class="form-group">
                    <label for="nombreEvento">
                        <i class="fas fa-calendar-check"></i> Nombre del Evento
                    </label>
                    <input type="text" id="nombreEvento" name="nombre_evento" required 
                           placeholder="Ej: Conferencia de Ingeniería">
                </div>

                <div class="form-group">
                    <label for="nombreSolicitante">
                        <i class="fas fa-user"></i> Nombre del Solicitante
                    </label>
                    <input type="text" id="nombreSolicitante" name="nombre_solicitante" required 
                           placeholder="Ej: Juan Pérez">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="fechaEvento">
                            <i class="fas fa-calendar"></i> Fecha
                        </label>
                        <input type="date" id="fechaEvento" name="fecha_evento" required>
                    </div>
                    <div class="form-group">
                        <label for="horaEvento">
                            <i class="fas fa-clock"></i> Hora
                        </label>
                        <input type="time" id="horaEvento" name="hora_evento" required>
                    </div>
                </div>

                <div class="form-group">
                <label for="espacioEvento">
                    <i class="fas fa-map-marker-alt"></i> Espacio
                </label>

                {% if espacio_preseleccionado %}
                    <!-- ✅ Solo un espacio: mostrar como texto plano -->
                    <input type="hidden" name="espacio_id" value="{{ espacio_preseleccionado.id }}">
                    <p style="margin: 0; padding: 0.5rem; background-color: #f0f0f0; border-radius: 4px;">
                        <strong>{{ espacio_preseleccionado.nombre }}</strong>
                    </p>
                {% else %}
                    <!-- ✅ Más de un espacio: mostrar select -->
                    <select id="espacioEvento" name="espacio_id" required>
                        <option value="">Selecciona un espacio...</option>
                        {% for espacio in espacios %}
                            <option value="{{ espacio.id }}">{{ espacio.nombre }}</option>
                        {% endfor %}
                    </select>
                {% endif %}
            </div>

                <div class="form-group">
                    <label for="descripcionEvento">
                        <i class="fas fa-align-left"></i> Descripción (Opcional)
                    </label>
                    <textarea id="descripcionEvento" name="descripcion" rows="3" 
                              placeholder="Descripción del evento..."></textarea>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn-cancelar" onclick="cerrarModalCrearEvento()">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                    <button type="submit" class="btn-confirmar">
                        <i class="fas fa-check"></i> Crear Evento
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="{% static 'encargados/js/dashboard_encargado.js' %}"></script>
</body>
</html>